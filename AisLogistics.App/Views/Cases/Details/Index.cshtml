@using AisLogistics.App.ViewModels.Cases
@using Microsoft.AspNetCore.Mvc.TagHelpers
@model ViewModelBuilder
@{
    ViewBag.Title = Model.ViewTitle;
    var requestModel = Model.Model as CaseDetailsResponseModel<CasesDto>;
}

<link rel="stylesheet" href="~/assets/vendor/libs/scanner.js/dist/scanner.css" />
<link rel="stylesheet" href="~/assets/css/case-details.css" asp-append-version="true" />
<link rel="stylesheet" href="~/assets/css/case-create.css" asp-append-version="true" />

<section>
    <div class="row">
        <div class="detail-card card p-5">
            @await Component.InvokeAsync("CaseInformation", new {caseDto = requestModel.Data.casesMainDto})
            <div class="case-app-body pt-5">
                <div class="row h-100 w-100 m-0">
                    <div class="col-lg-3 col-12 case-app-content ps-0">
                        <div class="case-user-list ps">
                            @foreach (var item in requestModel.Data.Services)
                            {
                                <div class="case-user-list_card" data-service-id="@item.Id">
                                    <div class="d-flex align-items-center mb-3">
                                        <div class="col">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="21" viewBox="0 0 20 21" fill="none" class="me-2">
                                                <path d="M14.918 14.8001C14.7013 14.1217 14.0763 13.6213 13.3346 13.6213H12.5013V11.0773C12.5013 10.8523 12.4135 10.6366 12.2572 10.4776C12.1009 10.3186 11.889 10.2292 11.668 10.2292H6.66797V8.53318H8.33464C8.55565 8.53318 8.76761 8.44383 8.92389 8.2848C9.08017 8.12576 9.16797 7.91006 9.16797 7.68515V5.9891H10.8346C11.2767 5.9891 11.7006 5.81041 12.0131 5.49233C12.3257 5.17426 12.5013 4.74286 12.5013 4.29304V3.94535C13.4984 4.35441 14.3832 5.00324 15.08 5.83631C15.7768 6.66938 16.2649 7.66187 16.5024 8.72883C16.74 9.79578 16.7199 10.9054 16.444 11.9628C16.168 13.0201 15.6444 13.9937 14.918 14.8001ZM9.16797 16.9541C5.8763 16.5386 3.33464 13.6892 3.33464 10.2292C3.33464 9.70345 3.4013 9.19464 3.50964 8.71126L7.5013 12.7733V13.6213C7.5013 14.0712 7.6769 14.5026 7.98946 14.8206C8.30202 15.1387 8.72594 15.3174 9.16797 15.3174M10.0013 1.74896C8.90695 1.74896 7.82332 1.96831 6.81227 2.39448C5.80123 2.82066 4.88257 3.44531 4.10875 4.23278C2.54594 5.82313 1.66797 7.98012 1.66797 10.2292C1.66797 12.4783 2.54594 14.6353 4.10875 16.2257C4.88257 17.0132 5.80123 17.6378 6.81227 18.064C7.82332 18.4902 8.90695 18.7095 10.0013 18.7095C12.2114 18.7095 14.3311 17.816 15.8939 16.2257C17.4567 14.6353 18.3346 12.4783 18.3346 10.2292C18.3346 9.11559 18.1191 8.01285 17.7003 6.98397C17.2815 5.9551 16.6677 5.02024 15.8939 4.23278C15.12 3.44531 14.2014 2.82066 13.1903 2.39448C12.1793 1.96831 11.0957 1.74896 10.0013 1.74896Z" fill="#077EFA" />
                                            </svg>
                                            <span class="b-s-14">
                                                @item.InteractionName
                                            </span>
                                        </div>
                                        <div class="col btn btn-warning">
                                            @item.Status.Name
                                        </div>
                                    </div>
                                    <p class="m-s-12">@(item.Name.Length > 350 ? item.Name.Substring(0, 350) + "..." : item.Name)</p>
                                    <p class="m-l-12">@item.ProcedureName</p>
                                    <p class="r-l-12">@(item.Office.Length > 350 ? item.Office.Substring(0, 350) + "..." : item.Office)</p>
                                    <a class="d-flex mb-3 text-decoration-underline" asp-action="ServiceDepartamentAddModal" asp-route-id="@item.Id" asp-route-officeid="@item.OfficeId"
                                   asp-route-departamentId="@item.DepartamentId" data-bs-toggle="tooltip" title="Добавить" data-btn-type="modal">
                                        
                                            @(item.DepartamentName ?? "Отдел не выбран") 
                                    </a>
                                    <div class="d-flex">
                                        <div class="col">
                                            <div class="b-s-12">Принял:</div>
                                            <div class="mb-0 r-s-12 ">@item.EmployeeAdd.Name</div>
                                            <p class="r-l-12">@item.EmployeeAdd.Job</p>
                                        </div>
                                        <div class="col">
                                            <div class="b-s-12">Текущий:</div>
                                            <div class="mb-0 r-s-12">@item.SerivesStage.EmployeeCurrent.Name</div>
                                            <p class="r-l-12">@item.SerivesStage.EmployeeCurrent.Job</p>
                                        </div>
                                    </div>
                                    <div class="d-flex">
                                        <div class="col">
                                            <div class="b-s-12">Этап:</div>
                                            <p>@item.SerivesStage.Stage.Name</p>
                                        </div>
                                        <div class="col">
                                            <div class="b-s-12">Дни:</div>
                                            <p><days count="@item.Days.Value"></days></p>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                    </div>
                    <div class="col-lg-6 col-12 case-app-content">
                        <partial name="Details/_ManageNav" view-data="ViewData" />
                        <div id="case-app-details"></div>
                    </div>
                    <div class="col-lg-3 col-12 case-app-content">
                        <div class="caseStages-wrapper overflow-auto p-0">
                            <div class="case-route-header d-flex justify-content-between px-4 pt-3 mb-4">
                                <div class="col-auto b-s-14">Этапы</div>
                                <div class="col-auto">
                                    @if (User.HasClaim(AccessKeyNames.DataCaseServiceStage, AccessKeyValues.Add))
                                    {
                                        <a href="javascript:void(0);" class="flex d-flex r-l-12" data-service-stages title="Добавить">
                                           <strong class="me-2">+</strong>
                                            Добавить
                                        </a>
                                    }
                                </div>
                            </div>
                            <div class="px-4" id=caseStages>
                            </div>
                        </div>
                        <div class="blancs_and_files-wrapper mt-5 overflow-auto">
                            <ul class="nav nav-custom nav-justified" role="tablist">
                                <li class="nav-item" role="presentation">
                                    <a class="nav-link active" id="blancs-tab" data-bs-toggle="tab" data-bs-target="#Expired" href="#" role="tab" aria-controls="Expired" aria-selected="true">
                                        Бланки
                                    </a>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <a class="nav-link" id="files-tab" data-bs-toggle="tab" href="#" role="tab" aria-controls="Lastday" aria-selected="false">
                                        Файлы
                                    </a>
                                </li>
                            </ul>
                            <div id="blancsAndFiles-content" class="blancs-scroll-area">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

@section Scripts
    {
    <script src="~/assets/vendor/libs/scanner.js/dist/scannerV2.js" type="text/javascript"></script>
    <script src="~/assets/js/pages/case-details.js"></script>
}