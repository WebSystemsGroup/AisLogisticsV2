@using AisLogistics.App.Models.DTO.Information
@using AisLogistics.App.Views.Cases.Details

@{
    ViewData["Title"] = "Главная";
    List<EmployeeInformationDto>? information = ViewBag.Inf;
    EmployeeWarningDto warnig = ViewBag.Warning;
    List<EmployeeNotesDto>? notes = ViewBag.Notes;
    List<EmployeeRatingDto>? ratings = ViewBag.Rating;
    var i = 1;
}

<link rel="stylesheet" href="~/assets/css/home-details.css" asp-append-version="true" />

<section>
    <p class="head-info mb-2">Информация</p>
    <div class="row m-0">
        <div id="leftButton" class="col-auto p-0 left-button d-flex d-none">
            <div class="my-auto"><i class="bi bi-chevron-left"></i></div>
        </div>
        <div class="col p-0">
            <div class="d-flex info-conteiner" id="information_list">
                @if (information is not null && information.Any())
                {
                    @foreach (var item in information)
                    {
                        <a asp-action="InformationDetailsModal" asp-controller="Home" asp-route-id="@item.Id" class="text-bodyrow col-3 my-3 ms-2 me-1 info-item-@i" data-btn-type="modal" data-bs-toggle="tooltip">
                            <div class="row m-2">
                                <div class="col-6">
                                    <span class="type">@item.Type</span>
                                </div>
                                <div class="col-6 pe-3 text-end">
                                    <span class="ms-auto">
                                        <small class="dateAdd">@item.DateAdd.ToLongDateString()</small>
                                    </span>
                                </div>
                            </div>
                            <div class="row col-12 m-2 mb-0">
                                <div class="topic">@item.Topic</div>
                            </div>
                            <div class="row col-12 m-2 mt-0 text-block">
                                <span class="text mt-2">@item.Text</span>
                            </div>
                            <div class="row m-2 mt-3">
                                <div class="col-12 d-flex justify-content-between">
                                    <span class="employeeFio">
                                        @item.EmployeeFio
                                    </span>
                                    <span class="employeeJob">
                                        @item.EmployeeJob
                                    </span>
                                </div>
                            </div>
                        </a>
                        <a asp-action="InformationDetailsModal" asp-controller="Home" asp-route-id="@item.Id" class="text-bodyrow col-3 my-3 ms-2 me-1 info-item-2" data-btn-type="modal" data-bs-toggle="tooltip">
                            <div class="row m-2">
                                <div class="col-6">
                                    <span class="type">@item.Type</span>
                                </div>
                                <div class="col-6 pe-3 text-end">
                                    <span class="ms-auto">
                                        <small class="dateAdd">@item.DateAdd.ToLongDateString()</small>
                                    </span>
                                </div>
                            </div>
                            <div class="row col-12 m-2 mb-0">
                                <div class="topic">@item.Topic</div>
                            </div>
                            <div class="row col-12 m-2 mt-0 text-block">
                                <span class="text mt-2">@item.Text</span>
                            </div>
                            <div class="row m-2 mt-3">
                                <div class="col-12 d-flex justify-content-between">
                                    <span class="employeeFio">
                                        @item.EmployeeFio
                                    </span>
                                    <span class="employeeJob">
                                        @item.EmployeeJob
                                    </span>
                                </div>
                            </div>
                        </a>
                        <a asp-action="InformationDetailsModal" asp-controller="Home" asp-route-id="@item.Id" class="text-bodyrow col-3 my-3 ms-2 me-1 info-item-3" data-btn-type="modal" data-bs-toggle="tooltip">
                            <div class="row m-2">
                                <div class="col-6">
                                    <span class="type">@item.Type</span>
                                </div>
                                <div class="col-6 pe-3 text-end">
                                    <span class="ms-auto">
                                        <small class="dateAdd">@item.DateAdd.ToLongDateString()</small>
                                    </span>
                                </div>
                            </div>
                            <div class="row col-12 m-2 mb-0">
                                <div class="topic">@item.Topic</div>
                            </div>
                            <div class="row col-12 m-2 mt-0 text-block">
                                <span class="text mt-2">@item.Text</span>
                            </div>
                            <div class="row m-2 mt-3">
                                <div class="col-12 d-flex justify-content-between">
                                    <span class="employeeFio">
                                        @item.EmployeeFio
                                    </span>
                                    <span class="employeeJob">
                                        @item.EmployeeJob
                                    </span>
                                </div>
                            </div>
                        </a>
                        <a asp-action="InformationDetailsModal" asp-controller="Home" asp-route-id="@item.Id" class="text-bodyrow col-3 my-3 ms-2 me-1 info-item-4" data-btn-type="modal" data-bs-toggle="tooltip">
                            <div class="row m-2">
                                <div class="col-6">
                                    <span class="type">@item.Type</span>
                                </div>
                                <div class="col-6 pe-3 text-end">
                                    <span class="ms-auto">
                                        <small class="dateAdd">@item.DateAdd.ToLongDateString()</small>
                                    </span>
                                </div>
                            </div>
                            <div class="row col-12 m-2 mb-0">
                                <div class="topic">@item.Topic</div>
                            </div>
                            <div class="row col-12 m-2 mt-0 text-block">
                                <span class="text mt-2">@item.Text</span>
                            </div>
                            <div class="row m-2 mt-3">
                                <div class="col-12 d-flex justify-content-between">
                                    <span class="employeeFio">
                                        @item.EmployeeFio
                                    </span>
                                    <span class="employeeJob">
                                        @item.EmployeeJob
                                    </span>
                                </div>
                            </div>
                        </a>
                        <a asp-action="InformationDetailsModal" asp-controller="Home" asp-route-id="@item.Id" class="text-bodyrow col-3 my-3 ms-2 me-1 info-item-4" data-btn-type="modal" data-bs-toggle="tooltip">
                            <div class="row m-2">
                                <div class="col-6">
                                    <span class="type">@item.Type</span>
                                </div>
                                <div class="col-6 pe-3 text-end">
                                    <span class="ms-auto">
                                        <small class="dateAdd">@item.DateAdd.ToLongDateString()</small>
                                    </span>
                                </div>
                            </div>
                            <div class="row col-12 m-2 mb-0">
                                <div class="topic">@item.Topic</div>
                            </div>
                            <div class="row col-12 m-2 mt-0 text-block">
                                <span class="text mt-2">@item.Text</span>
                            </div>
                            <div class="row m-2 mt-3">
                                <div class="col-12 d-flex justify-content-between">
                                    <span class="employeeFio">
                                        @item.EmployeeFio
                                    </span>
                                    <span class="employeeJob">
                                        @item.EmployeeJob
                                    </span>
                                </div>
                            </div>
                        </a>
                        i++;
                    }
                }
            </div>
        </div>
        <div id="rightButton" class="col-auto p-0 right-button d-flex">
            <div class="my-auto"><i class="bi bi-chevron-right"></i></div>
        </div>
    </div>
    <div class="row mt-4">
        <div class="col-8">
            <p class="head-info mb-2">Топ сотрудников за @DateTime.Now.AddDays(-1).ToString("Y")</p>
            <div class="info-employee" id="content-datatable">
                <div class="table-responsive pt-2">
                    <table id="tableRating" class="table table-sm ps-0"></table>
                </div>
            </div>
        </div>
        <div class="col-4 ps-2">
            <p class="head-info mb-2">Заметки</p>
            <div class="info-notes overflow-auto" id="notes_list">
                @if (notes is not null && notes.Any())
                {
                    @foreach (var item in notes)
                    {
                        <a asp-action="Details" asp-controller="Cases" asp-route-id="@item.DCasesId" class="row w-100 notes-item m-0 p-4">
                            <div class="col-6">
                                <p class="casesId mb-1">#@item.DCasesId</p>
                            </div>
                            <div class="col-6 text-end">
                                <span class="reminder"> Напомнить:</span> <span class="dateReminder"> @(item.DateReminder.HasValue ? item.DateReminder.Value.ToShortDateString() : string.Empty)</span>
                            </div>
                            <div class="row col-12 pb-1 ps-4 applicantName">
                                @item.ApplicantName
                            </div>
                            <div class="col-12 noteText mt-1">
                                @item.NoteText
                            </div>
                        </a>
                        <a asp-action="Details" asp-controller="Cases" asp-route-id="@item.DCasesId" class="row w-100 notes-item m-0 p-4">
                            <div class="col-6">
                                <p class="casesId mb-1">#@item.DCasesId</p>
                            </div>
                            <div class="col-6 text-end">
                                <span class="reminder"> Напомнить:</span> <span class="dateReminder"> @(item.DateReminder.HasValue ? item.DateReminder.Value.ToShortDateString() : string.Empty)</span>
                            </div>
                            <div class="row col-12 pb-1 ps-4 applicantName">
                                @item.ApplicantName
                            </div>
                            <div class="col-12 noteText mt-1">
                                @item.NoteText
                            </div>
                        </a>
                        <a asp-action="Details" asp-controller="Cases" asp-route-id="@item.DCasesId" class="row w-100 notes-item m-0 p-4">
                            <div class="col-6">
                                <p class="casesId mb-1">#@item.DCasesId</p>
                            </div>
                            <div class="col-6 text-end">
                                <span class="reminder"> Напомнить:</span> <span class="dateReminder"> @(item.DateReminder.HasValue ? item.DateReminder.Value.ToShortDateString() : string.Empty)</span>
                            </div>
                            <div class="row col-12 pb-1 ps-4 applicantName">
                                @item.ApplicantName
                            </div>
                            <div class="col-12 noteText mt-1">
                                @item.NoteText
                            </div>
                        </a>
                        <a asp-action="Details" asp-controller="Cases" asp-route-id="@item.DCasesId" class="row w-100 notes-item m-0 p-4">
                            <div class="col-6">
                                <p class="casesId mb-1">#@item.DCasesId</p>
                            </div>
                            <div class="col-6 text-end">
                                <span class="reminder"> Напомнить:</span> <span class="dateReminder"> @(item.DateReminder.HasValue ? item.DateReminder.Value.ToShortDateString() : string.Empty)</span>
                            </div>
                            <div class="row col-12 pb-1 ps-4 applicantName">
                                @item.ApplicantName
                            </div>
                            <div class="col-12 noteText mt-1">
                                @item.NoteText
                            </div>
                        </a>
                        <a asp-action="Details" asp-controller="Cases" asp-route-id="@item.DCasesId" class="row w-100 notes-item m-0 p-4">
                            <div class="col-6">
                                <p class="casesId mb-1">#@item.DCasesId</p>
                            </div>
                            <div class="col-6 text-end">
                                <span class="reminder"> Напомнить:</span> <span class="dateReminder"> @(item.DateReminder.HasValue ? item.DateReminder.Value.ToShortDateString() : string.Empty)</span>
                            </div>
                            <div class="row col-12 pb-1 ps-4 applicantName">
                                @item.ApplicantName
                            </div>
                            <div class="col-12 noteText mt-1">
                                @item.NoteText
                            </div>
                        </a>
                        <a asp-action="Details" asp-controller="Cases" asp-route-id="@item.DCasesId" class="row w-100 notes-item m-0 p-4">
                            <div class="col-6">
                                <p class="casesId mb-1">#@item.DCasesId</p>
                            </div>
                            <div class="col-6 text-end">
                                <span class="reminder"> Напомнить:</span> <span class="dateReminder"> @(item.DateReminder.HasValue ? item.DateReminder.Value.ToShortDateString() : string.Empty)</span>
                            </div>
                            <div class="row col-12 pb-1 ps-4 applicantName">
                                @item.ApplicantName
                            </div>
                            <div class="col-12 noteText mt-1">
                                @item.NoteText
                            </div>
                        </a>
                        <a asp-action="Details" asp-controller="Cases" asp-route-id="@item.DCasesId" class="row w-100 notes-item m-0 p-4">
                            <div class="col-6">
                                <p class="casesId mb-1">#@item.DCasesId</p>
                            </div>
                            <div class="col-6 text-end">
                                <span class="reminder"> Напомнить:</span> <span class="dateReminder"> @(item.DateReminder.HasValue ? item.DateReminder.Value.ToShortDateString() : string.Empty)</span>
                            </div>
                            <div class="row col-12 pb-1 ps-4 applicantName">
                                @item.ApplicantName
                            </div>
                            <div class="col-12 noteText mt-1">
                                @item.NoteText
                            </div>
                        </a>
                        <a asp-action="Details" asp-controller="Cases" asp-route-id="@item.DCasesId" class="row w-100 notes-item m-0 p-4">
                            <div class="col-6">
                                <p class="casesId mb-1">#@item.DCasesId</p>
                            </div>
                            <div class="col-6 text-end">
                                <span class="reminder"> Напомнить:</span> <span class="dateReminder"> @(item.DateReminder.HasValue ? item.DateReminder.Value.ToShortDateString() : string.Empty)</span>
                            </div>
                            <div class="row col-12 pb-1 ps-4 applicantName">
                                @item.ApplicantName
                            </div>
                            <div class="col-12 noteText mt-1">
                                @item.NoteText
                            </div>
                        </a>
                        <a asp-action="Details" asp-controller="Cases" asp-route-id="@item.DCasesId" class="row w-100 notes-item m-0 p-4">
                            <div class="col-6">
                                <p class="casesId mb-1">#@item.DCasesId</p>
                            </div>
                            <div class="col-6 text-end">
                                <span class="reminder"> Напомнить:</span> <span class="dateReminder"> @(item.DateReminder.HasValue ? item.DateReminder.Value.ToShortDateString() : string.Empty)</span>
                            </div>
                            <div class="row col-12 pb-1 ps-4 applicantName">
                                @item.ApplicantName
                            </div>
                            <div class="col-12 noteText mt-1">
                                @item.NoteText
                            </div>
                        </a>
                    }

                }
            </div>
        </div>
    </div>
</section>

@section Scripts {
    <script>

        (function () {
            //new PerfectScrollbar("#warning_list");
            new PerfectScrollbar("#rating_list");

            (function () {
                new PerfectScrollbar("#warning_list");
                new PerfectScrollbar("#information_list");
                new PerfectScrollbar("#notes_list");
            })();

        });
        $(document).ready(function () {
            const $table = $('#tableRating');
            $table.DataTable({
                sDom: "<'row'<'col-sm-12'tr>>",
                serverSide: true,
                ordering: false,
                "sScrollY": 440,
                searchDelay: 1500,
                ajax: {
                    url: 'Home/GetEmployeeRatingDataJson',
                    type: "POST",
                    datatype: "json",
                    dataSrc: function (json) {
                        console.log(json.data);
                        return json.data;
                    }
                },
                initComplete: function () {
                },
                columns: [
                    {
                        title: `Место`,
                        data: "positionId"
                    },
                    {
                        title: `ФИО`,
                        sWidth: '45%',
                        render: function (data, type, row) {
                            return row.employeeName + `<p class="offices mt-1 mb-2">${row.officessName}</p>`;
                        }
                    },
                    {
                        title: `Принято`,
                        className: 'employeePoint',
                        data: "employeePoint"
                    },
                    {
                        title: `Выдано`,
                        className: 'employeePoint',
                        data: "employeePoint"
                    },
                    {
                        title: `Консультация`,
                        className: 'employeePoint',
                        data: "employeePoint"
                    },
                    {
                        title: `Всего`,
                        className: 'total',
                        data: "employeePoint"
                    }
                ]
            });

            $('#rightButton').on('click', function () {
                if ($('#information_list').find('a').not('.d-none').length > 4)
                $('#information_list').find('a'f).not('.d-none')[0].addClass('d-none');
                $('#leftButton').removeClass('d-none');
            })

            $('#leftButton').on('click', function () {A
                $('#information_list').find('a.d-none').removeClass('d-none'); 
            })

        })

    </script>
}